<!DOCTYPE html>
<html>
<head>
  <title>QR Code Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/@zxing/library@latest"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/3.0.1/js.cookie.min.js"></script>
  <style>
    /* Estilos CSS */

    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background-color: #0174DF;
    }

    #container {
      text-align: center;
    }

    #title {
      font-size: 40px;
      font-weight: bold;
      color: yellow;
      margin-bottom: 20px;
    }

    #coins {
      font-size: 24px;
      color: yellow;
      margin-bottom: 20px;
    }

    #qr-code-result {
      font-size: 24px;
      font-weight: bold;
      color: white;
      text-align: center;
      margin-bottom: 20px;
    }

    #qr-code-time {
      font-size: 24px;
      color: yellow;
      margin-bottom: 20px;
    }

    #ar-video {
      max-width: 90%;
      width: 300px;
      height: 300px;
      border: 5px solid yellow;
    }

    #return-button {
      width: 200px;
      height: 50px;
      background-color: yellow;
      color: black;
      font-weight: bold;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      margin-bottom: 20px;
      display: none;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1 id="title">QR Code Maker</h1>
    <div id="coins">Moedas: 0</div>
    <hr>
    <video id="ar-video"></video>
    <div id="qr-code-result"></div>
    <div id="qr-code-time"></div>
    <button id="return-button">Retornar</button>
  </div>

  <script>
    const coinsPerScan = 10; // Número de moedas concedidas por leitura de QR code
    let totalCoins = 0; // Total de moedas do usuário
    let scannedQRCodes = []; // Array para armazenar os textos dos QR codes já lidos

    // Mapeamento dos QR codes e seus textos correspondentes
    const qrCodeTexts = {
      "CNC Laser": "Máquina CNC a laser",
      "Impressoras": "Texto do QR code 2",
      "VR": "Texto do QR code 3",
      "Lego": "Texto do QR code 3",
      "Caneta": "Texto do QR code 2",
      "23": "Exibição de impressões 3D feitas em resina , explicação como é feito esse processo de impressão, tipos de impressora, aplicações em projetos e comparativo entre impressão em resina e impressão com filamento.",
      "45": "Uma proposta pedagógica que auxilie na redução da ansiedade dos alunos, levando-os a refletirem sobre a importância da utilização de materiais recicláveis na preservação do meio ambiente e também utilizar esses materiais juntamente com a lógica de programação e do pensamento computacional",
      "46": "Desenvolvemos um DevKit denominado Box Makers. Uma caixinha em Acrílico (7 x 5 x 4 cm). Com um microcontrolador que é programado diretamente, via cabo USB, num computador (de preferência com acesso a Internet) e conectado com sensores diversos (temperatura, pressão, som, umidade, rodinhas, motores e etc).",
      "47": "EQUIPE DE FOGUETES ABAQUAR",
      "53": "A Ideia é montar uma pequena mostra de Robótica Educacional e um Desafio de Robótica (IoT)",
      "59": "O trabalho consiste em modelos makers das máscaras africanas e jogo africano Sishima",
      "63": "È a representação da distribuição normal (Gaussiana) Onde em um quadro tenho 800 amostras e vou demonstrar a distribuição Gaussiana",
      "65": "Modelos construídos baseados na concepção de alunos do ensino fundamental, acerca das temáticas de Ciências em que apresentassem mais dificuldades de aprendizagem.",
      "103": "A construção de um foguete de garrafa PET aborda diversos fenômenos científicos e físicos, como pressão, velocidade, impulso, força de arrasto, hidrodinâmica, aerodinâmica, movimento balístico, terceira lei de Newton, entre outros.Esse trabalho foi "batizado" pela equipe com o nome de PNEUMO TECH.",
      "104": "Sistemas Hidráulicos dos Foguetes",
      "105": "Mesa Air Soft",
      "112": "I Love You <3 (Jesus também)"
      "116": "O projeto "A Fabricação e os Jogos" é um projeto Maker de desenvolvimento de jogos para a melhoria da infraestrutura da instituição, aplicando conhecimentos físicos e técnicos obtidos nos cursos do CEFET-RJ, para a fabricação. Nesta etapa, foi fabricado o protótipo de uma mesa de Pebolim, que foi projetado por modelagem 3D e fabricado com a estrutura do laboratório Maker. Ao final o protótipo fica disponível como mais uma opção de atividade para os alunos do CEFET-RJ.",
      "118": "Desenvolvimento do protótipo de uma máquina de cura, para tratamento de resina fotopolimerizável.",
      "119": "O projeto "Incubadora 4.0" tem como objetivo principal desenvolver uma incubadora que melhore a qualidade de vida de bebês internados, conectando-os com suas famílias.",
      "120": "Mão Biônica desenvolvida por alunos do Médio Técnico do CEFET Itaguaí",
      "122": "Modelos Makers elaborados na disciplina de LCCT e Física ministrados na Escola Estadual José Maria de Brito , no qual os alunos do ensino médio construíram protótipos de robôs , carros e jogos envolvendo ou não circuito elétrico com material reciclado e de baixo custo, estimulando a criatividade.",
      "123": "Rôbos desenvolvidos com Arduino",
      "126": "As turmas TIM 1M e TIM 1T participaram do Concurso Internacional de Redacao dos Correios e produziram, individualmente, redações sobre o tema proposto: uma carta argumentativa na qual um herói criado por eles expusesse os poderes que usaria para deixar as estradas mais seguras para as crianças. As duas melhores redações foram inscritas e concorrem aos prêmios.",
      "130": "Uma estufa de cura para resina fotopolimerizável.",
      "136": "O projeto tem como objetivo desenvolver um medidor de combustível para um carro Off Road. Atualmente temos um protótipo, feito com Arduíno, que futuramente, quando estiver finalizado, será implementado no sistema do Baja, do projeto de extensão Galo Baja.",
      "Bonus-1": "Parabens! Ganhou o Qr code Bônus-1!!",
      "Bonus-2": "Parabens! Ganhou o Qr code Bônus-2!!",
      "Bonus-3": "Parabens! Ganhou o Qr code Bônus-3!!",
      "Bonus-4": "Parabens! Ganhou o Qr code Bônus-4!!"
      // Adicione mais QR codes e seus respectivos textos aqui
    };

    // Função para atualizar a pontuação exibida na página
    function updateCoins() {
      const coinsElement = document.getElementById('coins');
      coinsElement.innerText = `Moedas: ${totalCoins}`;

      // Armazenar a pontuação em um cookie
      Cookies.set('userCoins', totalCoins);
    }

    // Função para atualizar o horário exibido na página
    function updateTime(time) {
      const timeElement = document.getElementById('qr-code-time');
      timeElement.innerText = `Horário do último QR code: ${time}`;

      // Armazenar o horário em um cookie
      Cookies.set('qrCodeTime', time);
    }

    // Função para processar o texto do QR code
    function processQRCodeText(text) {
      const qrCodeResultElement = document.getElementById('qr-code-result');
      qrCodeResultElement.innerText = text;

      // Verificar se o QR code já foi processado antes de conceder moedas
      if (!scannedQRCodes.includes(text)) {
        totalCoins += coinsPerScan;
        scannedQRCodes.push(text); // Adicionar o texto do QR code ao array de QR codes lidos
        updateCoins();
      }

      // Obter o horário atual
      const currentTime = new Date().toLocaleTimeString();
      updateTime(currentTime);

      const returnButton = document.getElementById('return-button');
      returnButton.style.display = 'block';
    }

    // Função executada quando um QR code é lido
    function onQRCodeRead(result) {
      if (result && result.text) {
        const qrCodeText = result.text;
        const text = qrCodeTexts[qrCodeText];
        if (text) {
          processQRCodeText(text);
        }
      }
    }

    // Função executada quando o botão de retornar é clicado
    function onReturnButtonClick() {
      const qrCodeResultElement = document.getElementById('qr-code-result');
      qrCodeResultElement.innerText = '';

      const qrCodeTimeElement = document.getElementById('qr-code-time');
      qrCodeTimeElement.innerText = '';

      const returnButton = document.getElementById('return-button');
      returnButton.style.display = 'none';

      startQRCodeReader(); // Reiniciar a leitura de QR codes
    }

    // Função para iniciar o leitor de QR code
    function startQRCodeReader() {
      const codeReader = new ZXing.BrowserQRCodeReader();
      codeReader
        .decodeOnceFromVideoDevice(undefined, 'ar-video')
        .then((result) => {
          onQRCodeRead(result);
        })
        .catch((err) => {
          console.error(err);
        });
    }

    // Função para parar o leitor de QR code
    function stopQRCodeReader() {
      ZXing.BrowserQRCodeReader.reset();
    }

    // Iniciar a leitura de QR codes ao carregar a página
    window.addEventListener('load', () => {
      const returnButton = document.getElementById('return-button');
      returnButton.addEventListener('click', onReturnButtonClick);

      // Verificar se há um cookie com a pontuação do usuário
      const userCoins = Cookies.get('userCoins');
      if (userCoins) {
        totalCoins = parseInt(userCoins);
        updateCoins();
      }

      // Verificar se há um cookie com o horário do último QR code
      const qrCodeTime = Cookies.get('qrCodeTime');
      if (qrCodeTime) {
        updateTime(qrCodeTime);
      }

      startQRCodeReader();
    });
  </script>
</body>
</html>
